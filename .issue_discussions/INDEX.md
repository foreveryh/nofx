# NOFX Issue 讨论索引

## 📋 概述

本目录存储对 NOFX 项目中发现的 Issue 的深度分析和讨论记录。

**更新时间**: 2025-11-02

---

## 📑 已分析的 Issue

### 1. Issue #202：AI 做空偏好问题

**文件**: `2025-11-02_issue_202_short_bias.md`

**问题概述**: 基础策略有很严重的空头喜好倾向，需要修改 prompt 和参数

**关键发现**:
- ❌ System Prompt 措辞偏向做空
- ❌ JSON 示例顺序强化做空优先级
- ❌ 风险回报比计算对做空不对称

**优先级**: 🔴 高

**状态**: 🔍 已分析 ✅

**修复方案**: 
- 方案 A（推荐）：修改 System Prompt 措辞
- 方案 B（保守）：添加做空额外限制
- 方案 C（高级）：优化风险计算对称性

**相关文件**:
- `decision/engine.go` - AI 决策引擎
- 第 203-316 行 - System Prompt 构建
- 第 534-622 行 - 决策验证逻辑

**参考链接**: https://github.com/NoFxAiOS/nofx/issues/202

**关键代码行**:
- L229-235: 做空激励措辞 🔴
- L298-301: JSON 示例顺序 🔴
- L591-614: 风险回报比计算 🔴

---

## 📊 统计信息

| 指标 | 数值 |
|------|------|
| 已分析 Issue 数 | 1 |
| 高优先级 | 1 |
| 中优先级 | 0 |
| 低优先级 | 0 |

---

## 🔍 按主题分类

### 交易决策相关
- Issue #202: AI 做空偏好

### 风险控制相关
- Issue #202: 涉及验证逻辑不对称

### Prompt/AI 相关
- Issue #202: System Prompt 措辞问题

### 性能监控相关
- 待添加...

---

## 💡 常见问题模式

### 模式 1：AI 偏好问题
**表现**: AI 过度倾向某种决策
**示例**: Issue #202 - 做空偏好
**根本原因**: Prompt 措辞 / 示例顺序 / 数学计算

### 模式 2：待定义...

---

## 🛠 修复清单

### 待处理
- [ ] Issue #202 - 实施方案 A（修改 Prompt）
- [ ] Issue #202 - 实施方案 B（做空限制）
- [ ] Issue #202 - 添加监控指标

### 已完成
- [x] Issue #202 - 问题分析

---

## 📚 相关文档

### 核心架构文档
- `README.md` - 项目概览
- `CUSTOM_API.md` - 自定义 API
- `DOCKER_DEPLOY.md` - Docker 部署

### 代码文件
- `decision/engine.go` - AI 决策引擎
- `trader/auto_trader.go` - 自动交易
- `decision/decision.go` - 决策结构
- `mcp/client.go` - AI 通信

---

## 🔗 快速导航

### 按日期
- 2025-11-02
  - `2025-11-02_issue_202_short_bias.md` - Issue #202 分析

### 按优先级
- 🔴 高优先级
  - Issue #202

### 按影响范围
- **AI 决策层** - Issue #202
- **验证层** - Issue #202
- **执行层** - 待添加...
- **监控层** - 待添加...

---

## 📝 笔记

### 关键发现
1. **Prompt 工程很重要** - 微小的措辞改变可能导致 AI 行为大幅偏离
2. **示例顺序有影响** - AI 倾向于按示例顺序优先考虑
3. **数学计算要对称** - 做多/做空的风险计算需要真正对称

### 监控重点
- 做多/做空交易比例（应接近 1:1）
- 两种方向的胜率（应相等）
- 两种方向的平均盈亏比（应相等）

---

## 🎯 下次行动

1. **立即**: 审查 Issue #202 修复方案
2. **本周**: 实施方案 A + B
3. **下周**: 监控修复后的性能指标
4. **持续**: 寻找其他 AI 偏好问题

---

**创建时间**: 2025-11-02  
**维护者**: peng  
**版本**: 1.0
